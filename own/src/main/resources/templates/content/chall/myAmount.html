<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/default_layout}" lang="ko">

<head>
	<!-- jquery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
	<meta content="width=device-width, initial-scale=1.0" name="viewport" />
	<meta content="Free HTML Templates" name="keywords" />
	<!-- Favicon -->
	<link href="/css/chall/img/favicon.ico" rel="icon" />
	<!-- Google Web Fonts -->
	<link rel="preconnect" href="https://fonts.gstatic.com" />
	<link href="https://fonts.googleapis.com/css2?family=Handlee&family=Nunito&display=swap" rel="stylesheet" />
	<!-- Font Awesome -->
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet" />
	<!-- Flaticon Font -->
	<link href="/css/chall/lib/flaticon/font/flaticon.css" rel="stylesheet" />
	<!-- Libraries Stylesheet -->
	<link href="/css/chall/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet" />
	<link href="/css/chall/lib/lightbox/css/lightbox.min.css" rel="stylesheet" />
	<!-- Customized Bootstrap Stylesheet -->
	<link href="/css/chall/css/style.css" rel="stylesheet" />
	<!-- JavaScript Libraries -->
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
	<script src="/css/chall/lib/easing/easing.min.js"></script>
	<script src="/css/chall/lib/owlcarousel/owl.carousel.min.js"></script>
	<script src="/css/chall/lib/isotope/isotope.pkgd.min.js"></script>
	<script src="/css/chall/lib/lightbox/js/lightbox.min.js"></script>
	<!-- Contact Javascript File -->
	<script src="/css/chall/mail/jqBootstrapValidation.min.js"></script>
	<script src="/css/chall/mail/contact.js"></script>
	<!-- Template Javascript -->
	<script src="/css/chall/js/main.js"></script>
	<!-- google chart -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
	<style>
		@import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap");

		/* Reset Style */

		/* Responsive Table Style */
		.responsive-table {
			background-color: #fefefe;
			border-collapse: collapse;
			border-radius: 10px;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.02);
			width: 100%;
			margin: 2rem 0;
			overflow: hidden;
		}

		.responsive-table__row {
			display: grid;
			border-bottom: 1px solid #edeef2;
			padding: 0 1.5rem;
		}

		@media (min-width: 768px) {
			.responsive-table__row {
				grid-template-columns: 2fr 1fr 2fr 2fr 1fr;
			}
		}

		@media (min-width: 768px) and (max-width: 991px) {
			.responsive-table__row {
				grid-template-columns: 1fr 2fr 1fr;
			}
		}

		.responsive-table__row th,
		.responsive-table__row td {
			padding: 1rem;
			text-align: center;
		}

		.responsive-table__head {
			background-color: #e1e8f2;
		}

		@media (max-width: 991px) {
			.responsive-table__head {
				display: none;
			}
		}

		.responsive-table__head__title {
			display: flex;
			align-items: center;
			justify-content: center;
			font-weight: 500;
			text-transform: capitalize;
		}

		.responsive-table__body .responsive-table__row {
			transition: 0.1s linear;
			transition-property: color, background;
		}

		.responsive-table__body .responsive-table__row:last-child {
			border-bottom: none;
		}

		.responsive-table__body .responsive-table__row:hover {
			color: #fff;
			background-color: #6ab0cd; 
		}

		.responsive-table__body__text {
			display: flex;
			flex-wrap: wrap;
			align-items: center;
			justify-content: center;
		}

		.responsive-table__body__text::before {
			margin-right: 1rem;
			font-weight: 600;
			text-transform: capitalize;
		}

		@media (max-width: 991px) {
			.responsive-table__body__text::before {
				content: attr(data-title) " :";
			}
		}

		@media (max-width: 400px) {
			.responsive-table__body__text::before {
				width: 100%;
				margin-bottom: 1rem;
			}
		}

		.responsive-table__body__text--name {
			font-weight: 600;
		}

		@media (min-width: 768px) {
			.responsive-table__body__text--name::before {
				display: none;
			}
		}

		@media (min-width: 768px) and (max-width: 991px) {
			.responsive-table__body__text--name {
				grid-column: 0.5;
				flex-direction: column;
			}
		}

		@media (min-width: 768px) and (max-width: 991px) {

			.responsive-table__body__text--status,
			.responsive-table__body__text--types,
			.responsive-table__body__text--update {
				grid-column: 0.6666666667;
			}
		}

		@media (min-width: 768px) and (max-width: 991px) {
			.responsive-table__body__text--country {
				grid-column: -3;
			}
		}

		@media (min-width: 768px) and (max-width: 991px) {

			.responsive-table__body__text--name,
			.responsive-table__body__text--country {
				grid-row: 2;
			}
		}

		/* Status Indicator Style */
		.status-indicator {
			display: inline-block;
			width: 1.8rem;
			height: 1.8rem;
			border-radius: 50%;
			background: #222;
			margin-right: 0.5rem;
		}

		.status-indicator--active {
			background: #25be64;
		}

		.status-indicator--inactive {
			background: #dadde4;
		}

		.status-indicator--new {
			background: #febf02;
		}
	</style>
	<meta charset="utf-8">
	<title>도전_마이페이지_내 예치금</title>
</head>
<div layout:fragment="content">
<body>
	<!-- Header Start -->
	<div class="container-fluid bg-primary mb-5">
		<div class="d-flex flex-column align-items-center justify-content-center" style="min-height: 400px">
			<h3 class="display-3 font-weight-bold text-white">Contact Us</h3>
			<div class="d-inline-flex text-white">
				<p class="m-0">
					<a class="text-white" href="">Home</a>
				</p>
				<p class="m-0 px-2">/</p>
				<p class="m-0">Contact Us</p>
			</div>
		</div>
	</div>
	<!-- Header End -->
	<!-- 내 현재 예치금, 내 예금주 .. 등 -> cmemberVO -->
	<!-- 내 충전, 출금 상금 등의 내역  -> CAmountVO -->
	<!-- 두 것을..조인해서 가져와야함. 멤버별로 뽑을땐 cmemeberd에서
	내거에서 내역별로 볼 때는..  -->

	<!-- Contact Start -->
	<div class="container-fluid pt-5">
		<div class="container">
			<div class="text-center pb-2">
				<p class="section-title px-5">
					<span class="px-2">MY PAGE</span>
				</p>
			</div>
			<div class="row">
				<div class="col-12 text-center mb-2">
					<ul class="list-inline mb-4" id="portfolio-flters">
						<li class="btn btn-outline-primary m-1"><a href="/own/chall/mypage">내 정보</a></li>
						<li class="btn btn-outline-primary m-1 active">내 예치금</li>
						<li class="btn btn-outline-primary m-1"><a href="/own/chall/myChall">내 도전</a></li>
						<li class="btn btn-outline-primary m-1">내 인증내역</li>
					</ul>
				</div>
			</div>
			<div class="col-12" style="text-align: center; ">
				<h3>
					내 현재 보유예치금:<span th:text=${memInfo.memAmt} id="myNowAmt"></span>
				</h3>
				<p class="btn btn-outline-primary m-1"><a href="/own/chall/payAmount">충전하러가기</a></p>
				<h3>
					내 계좌정보:<span th:text=${memInfo.memAcc}></span> <span>[[${memInfo.memAccname}]]</span>
				</h3>
				<p>내 계좌로 환급하기</p>
				<!-- 유저아이디 히든 -->
				 <form action="/own/chall/refundAmt" method="post" id="insertChall">
				 <input id="userId" name="userId"  type="hidden" th:value="${session.loginUser.userId}">
				 <input id="amtMethod" name="amtMethod"  type="hidden" th:value="${memInfo.memBank} + ${memInfo.memAccname}">
				 환급금액:<input type="number" name="price"  id="price" min="1000" max="300000" required="required">
				<!-- 환급금액:<input type="number" min="1000" max="300000" required="required" id="refundPrice">-->
				<!--<p class="btn btn-outline-primary m-1" id="refundBtn">환급하기-->
				<button>환급신청</button>
				</form>
			</div>
			<table class="responsive-table" id="amtTable">
				<thead class="responsive-table__head">
					<tr class="responsive-table__row">
						<th class="responsive-table__head__title">날짜</th>
						<th class="responsive-table__head__title">유형</th>
						<th class="responsive-table__head__title">결제방법</th>
						<th class="responsive-table__head__title">금액</th>
						<th class="responsive-table__head__title">도전번호</th>
					</tr>
				</thead>
				<tbody class="responsive-table__body">
						<tr class="responsive-table__row" th:each="amt: ${memAmount}">
							<td class="responsive-table__body__text" th:text="${#dates.format(amt.challAmountDate, 'yyyy-MM-dd HH:mm')}" />
							<td class="responsive-table__body__text" th:text="${amt.amtType}" />
							<td class="responsive-table__body__text" th:text="${amt.amtMethod}" />
							<td class="responsive-table__body__text" th:text="${amt.price}"></td>
							<td class="responsive-table__body__text" th:text="${amt.challNo}"></td>
						</tr>
				</tbody>
			</table>

			<!-- 나의도전 페이징 -->
			<nav class="blog-pagination justify-content-center d-flex pageBtn" id="pageMyAmount">
			<!--================ 이전  =================-->
			<ul class="pagination">
				<li class="page-item" th:if="${memAmount[0].paging.startPage>1}"><a
					class="page-link" aria-label="Previous"
					th:value="${memAmount[0].paging.startPage-1}"> <span aria-hidden="true"><span
							class="lnr lnr-chevron-left pagePort"></span></span></a></li>
				<!--================ 페이지 이동 1_2_3_4_5  =================-->
				<th:block
					th:each="pag:${#numbers.sequence(memAmount[0].paging.startPage, memAmount[0].paging.endPage)}">
					<li class="page-item" th:if="${pag != memAmount[0].paging.page}"><a
						class="page-link pagePort" th:value="${pag}"
						th:text="${#numbers.formatInteger(pag,1)}"></a></li>
					<li class="page-item active" th:if="${pag==memAmount[0].paging.page}"><a
						class="page-link" th:text="${#numbers.formatInteger(pag,1)}"></a>
					</li>
				</th:block>
				<!--================ 페이지 이동 1_2_3_4_5 끝 =================-->
				<!--================ 이후  =================-->
				<li class="page-item" th:if="${memAmount[0].paging.endPage < memAmount[0].paging.lastPage}">
					<a class="page-link pagePort" aria-label="Next"
					th:value="${memAmount[0].paging.endPage+1}"> <span aria-hidden="true"><span
							class="lnr lnr-chevron-right"></span></span></a>
				</li>
			</ul>
		</nav>
	<!--나의도전 페이징 끝 -->
		</div>
	</div>
	<!-- Contact End -->


	<!-- Footer Start -->
	<div
		class="container-fluid bg-secondary text-white mt-5 py-5 px-sm-3 px-md-5">
		<div class="row pt-5">
			<div class="col-lg-3 col-md-6 mb-5">
				<a href=""
					class="navbar-brand font-weight-bold text-primary m-0 mb-4 p-0"
					style="font-size: 40px; line-height: 40px"> <i
					class="flaticon-043-teddy-bear"></i> <span class="text-white">KidKinder</span>
				</a>
				<p>Labore dolor amet ipsum ea, erat sit ipsum duo eos. Volup
					amet ea dolor et magna dolor, elitr rebum duo est sed diam elitr.
					Stet elitr stet diam duo eos rebum ipsum diam ipsum elitr.</p>
				<div class="d-flex justify-content-start mt-4">
					<a
						class="btn btn-outline-primary rounded-circle text-center mr-2 px-0"
						style="width: 38px; height: 38px" href="#"><i
						class="fab fa-twitter"></i></a> <a
						class="btn btn-outline-primary rounded-circle text-center mr-2 px-0"
						style="width: 38px; height: 38px" href="#"><i
						class="fab fa-facebook-f"></i></a> <a
						class="btn btn-outline-primary rounded-circle text-center mr-2 px-0"
						style="width: 38px; height: 38px" href="#"><i
						class="fab fa-linkedin-in"></i></a> <a
						class="btn btn-outline-primary rounded-circle text-center mr-2 px-0"
						style="width: 38px; height: 38px" href="#"><i
						class="fab fa-instagram"></i></a>
				</div>
			</div>
			<div class="col-lg-3 col-md-6 mb-5">
				<h3 class="text-primary mb-4">Get In Touch</h3>
				<div class="d-flex">
					<h4 class="fa fa-map-marker-alt text-primary"></h4>
					<div class="pl-3">
						<h5 class="text-white">Address</h5>
						<p>123 Street, New York, USA</p>
					</div>
				</div>
				<div class="d-flex">
					<h4 class="fa fa-envelope text-primary"></h4>
					<div class="pl-3">
						<h5 class="text-white">Email</h5>
						<p>info@example.com</p>
					</div>
				</div>
				<div class="d-flex">
					<h4 class="fa fa-phone-alt text-primary"></h4>
					<div class="pl-3">
						<h5 class="text-white">Phone</h5>
						<p>+012 345 67890</p>
					</div>
				</div>
			</div>
			<div class="col-lg-3 col-md-6 mb-5">
				<h3 class="text-primary mb-4">Quick Links</h3>
				<div class="d-flex flex-column justify-content-start">
					<a class="text-white mb-2" href="#"><i
						class="fa fa-angle-right mr-2"></i>Home</a> <a class="text-white mb-2"
						href="#"><i class="fa fa-angle-right mr-2"></i>About Us</a> <a
						class="text-white mb-2" href="#"><i
						class="fa fa-angle-right mr-2"></i>Our Classes</a> <a
						class="text-white mb-2" href="#"><i
						class="fa fa-angle-right mr-2"></i>Our Teachers</a> <a
						class="text-white mb-2" href="#"><i
						class="fa fa-angle-right mr-2"></i>Our Blog</a> <a class="text-white"
						href="#"><i class="fa fa-angle-right mr-2"></i>Contact Us</a>
				</div>
			</div>
			<div class="col-lg-3 col-md-6 mb-5">
				<h3 class="text-primary mb-4">Newsletter</h3>
				<form action="">
					<div class="form-group">
						<input type="text" class="form-control border-0 py-4"
							placeholder="Your Name" required="required" />
					</div>
					<div class="form-group">
						<input type="email" class="form-control border-0 py-4"
							placeholder="Your Email" required="required" />
					</div>
					<div>
						<button class="btn btn-primary btn-block border-0 py-3"
							type="submit">Submit Now</button>
					</div>
				</form>
			</div>
		</div>
		<div class="container-fluid pt-5"
			style="border-top: 1px solid rgba(23, 162, 184, 0.2);">
			<p class="m-0 text-center text-white">
				&copy; <a class="text-primary font-weight-bold" href="#">Your
					Site Name</a>. All Rights Reserved.

				<!--/*** This template is free as long as you keep the footer author’s credit link/attribution link/backlink. If you'd like to use the template without the footer author’s credit link/attribution link/backlink, you can purchase the Credit Removal License from "https://htmlcodex.com/credit-removal". Thank you for your support. ***/-->
				Designed by <a class="text-primary font-weight-bold"
					href="https://htmlcodex.com">HTML Codex</a> <br />Distributed By:
				<a href="https://themewagon.com" target="_blank">ThemeWagon</a>
			</p>
		</div>
	</div>
	<!-- Footer End -->
	<script>
		let userId = $('#userId').val();
		//토큰있어야 post가능~!
		/*<![CDATA[*/
		var header = '[[${_csrf.headerName}]]';
		var token = '[[${_csrf.token}]]';
		console.log(header);
		console.log(token);

	/*	let rfBtn = document.getElementById('refundBtn');
		let rfPrice = document.getElementById("refundPrice");
		rfBtn.addEventListener('click', function(){
			console.log(rfPrice.value);
		})
		console.log(rfPrice); */

		$('#refundBtn').on('click', function(){
			let rfPrice = $('#refundPrice').val();
			let myAmt = $('#myNowAmt').text();
			let userId = $('#userId').val();
			console.log(myAmt);
			console.log(rfPrice);
			if(rfPrice < 1000){
				alert("1000원 이상 출금 가능합니다.");
			}
			if(Number(myAmt) < rfPrice){
				alert("보유 예치금을 초과하여 출금할 수 없습니다.")
			}
			//둘다 해당될 경우 아작스 - 출금아작스
			if( rfPrice> 1000 && Number(myAmt) > rfPrice){
				console.log(userId);
				console.log("출금가능");
				//회원아이디, 금액, type -> 출금/ method -> 계좌환불
				/*
										userId: userId,
							        	   price: payPrice,
							        	   amtMethod: amtMethod,
							        	   amtType: amtType
				*/
				/*$.ajax({
					url:'/own/chall/refundAmt',
					method:'post',
					data:JSON.stringify({userId:userId,
										 price: rfPrice,
							        	 amtType: "출금",
										 amtMethod: "계좌이체",
					}),
					beforeSend : function(xhr){
						         xhr.setRequestHeader(header, token);
					},
					contentType:"application/json",
					success:function(res){
						console.log(res);
						let changeAmt = Number(myAmt) - Number(rfPrice);
						console.log(changeAmt);
						location.href = '/own/chall/myAmount'
					},
					error: function(err){
						console.log(err);
					}
				});*/
				location.href = '/own/chall/applyForm?challNo=' + challNo + '&&userId=' + userId;
			}
		});

		// 내 인증 페이징 버튼 아작스.
		$('#pageMyAmount').on('click', '.pagePort', function(){
		    //페이지번호 + 밴드식별번호
		    let page = $(this).attr('value');
			console.log(page)
		    console.log($(this).attr('value')); 
			console.log("유저 아이디..위에 선언한거...."+userId);
		    $.ajax({
		       url: '/own/chall/myAmtAjax',
		       method: 'get',
			   data: { page: page,
					   userId: userId}
		    }).then(result => {
		       console.log(result);
				//형태만들기 이미있는애들 없애준다.. -> 도전폼
				let amtTb = $('#amtTable tbody');
				console.log("정보.....");
				console.log(amtTb);
				amtTb.empty();
				//다시 형태 붙이는애 만들어주기..
				result.forEach(res => {
					makeTr(res);
		       	})
				let pagingName = 'pageMyAmount';
				makePaging(result, pagingName);
				})
		    });

			function makeTr(res){
				console.log(res);
				let amtType = res.amtType;
				let amtDate = res.challAmountDate;
				let amtMethod = res.amtMethod;
				let amtPrice = res.price;
				let amtChallNo = res.challNo;
				let trTag = `<tr class="responsive-table__row">
								<td class="responsive-table__body__text">${amtDate}</td>
								<td class="responsive-table__body__text">${amtType}</td>
								<td class="responsive-table__body__text">${amtMethod}</td>
								<td class="responsive-table__body__text">${amtPrice}</td>
								<td class="responsive-table__body__text">${amtChallNo}</td>
							</tr>`
				$('#amtTable tbody').append(trTag);
			}

			/* 아작스 페이징 버튼 */
			function makePaging(result, pagingName){
				//버튼 다시초기화..비우기
				$(`#${pagingName}`).empty();
				let pagingM = result[0].paging;
				//시작 버튼
				console.log(result[0]); //첫번째? 가져오기..?
				let startpageTag = $('<ul class="pagination" />');
				$(`#${pagingName}`).append(startpageTag);
				//이전 버튼만들기
				if(pagingM.startPage>1){
				let pageBeforTag = `<li class="page-item">
									<a class="page-link pagePort" aria-label="Previous" value=${pagingM.startPage-1}>
									<span aria-hidden="true"> <-
									<span class="lnr lnr-chevron-left pagePort"></span></span></a>
									</li>`
				startpageTag.append(pageBeforTag); 
				}               
				//페이지목록..
				for(let pg = pagingM.startPage; pg<=pagingM.endPage; pg++){
						if(pg != pagingM.page){
							let pageTag = `<li class="page-item">
										<a class="page-link pagePort" value=${pg}>${pg}</a>
										</li>`
							startpageTag.append(pageTag);
						} else if(pg == pagingM.page ){
							let pageTag =  `<li class="page-item active">
								<a class="page-link" >${pg}</a>
								</li>`
								startpageTag.append(pageTag);
						}
				}               
				//이후 버튼만들기
				if(pagingM.endPage<pagingM.lastPage){
							let pageAfterTag =`<li class="page-item">
								<a class="page-link pagePort" aria-label="Next" value=${pagingM.endPage+1}>
									<span aria-hidden="true"> ->
									<span class="lnr lnr-chevron-right"></span></span></a>
									</li>`
									startpageTag.append(pageAfterTag);
								}
								$(`#${pagingName}`).append(startpageTag);
				};

	</script>
</body>
</div>
</html>