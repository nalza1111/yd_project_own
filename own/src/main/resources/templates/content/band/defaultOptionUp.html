<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/band_layout}" lang="ko">
<head>
<!-- jquery -->
<script type="text/javascript" src="/css/band/js/jquery-3.2.1.js"></script>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="icon" href="/css/band/image/favicon.png" type="image/png">
<title>Royal Hotel</title>
<!-- Bootstrap CSS -->
<link rel="stylesheet" href="/css/band/css/bootstrap.css">
<link rel="stylesheet" href="/css/band/vendors/linericon/style.css">
<link rel="stylesheet" href="/css/band/css/font-awesome.min.css">
<link rel="stylesheet"
	href="/css/band/vendors/owl-carousel/owl.carousel.min.css">
<link rel="stylesheet"
	href="/css/band/vendors/bootstrap-datepicker/bootstrap-datetimepicker.min.css">
<link rel="stylesheet"
	href="/css/band/vendors/nice-select/css/nice-select.css">
<link rel="stylesheet"
	href="/css/band/vendors/owl-carousel/owl.carousel.min.css">
<!-- main css -->
<link rel="stylesheet" href="/css/band/css/style.css">
<link rel="stylesheet" href="/css/band/css/responsive.css">
<style>
.btn:hover {
	color: #fff;
}

.input-text:focus {
	box-shadow: 0px 0px 0px;
	border-color: #f8c146;
	outline: 0px;
}

.form-control {
	border: 1px solid #f8c146;
}

img {
	border-radius: 10px;
}

img:hover {
	border: #BFBFBF 2px solid;
	cursor: pointer;
}

.aaimg {
	padding: 5px;
	border-radius: 10px;
	height: 100px;
	width: 100px;
	border-radius: 15px;
}
ul{
   list-style:none;
   }
.wrap{
   padding:15px;
   letter-spacing:-0.5px;
   }
.tab_menu{
   position:relative;
   }
.tab_menu .list{
   overflow:hidden;
   background-color:#333;
   }
.tab_menu .list li{
   float:left;
   margin-right:20px;
   }
.tab_menu .list .btns{
   font-size:25px;
   color: white;
   }
.bBox {
		    width: 60px;
		    height: 60px; 
		    border-radius: 30%;
		    overflow: hidden;
		}   
.bProfile {
		    width: 100%;
		    height: 100%;
		    object-fit: cover;
		    border-radius: 30%;
		    border: 3px solid #00394F;
		}
</style>
</head>
<body>
	<div layout:fragment="content">
		<!--================위에  Area =================-->
		<section class="banner_area">
			<div class="booking_table d_flex align-items-center"
				style="min-height: 200px;">
				<div class="overlay bg-parallax" data-stellar-ratio="0.9"
					data-stellar-vertical-offset="0" data-background=""></div>
				<div>
					<h2 class="typo-list" style="color: white">내 가치</h2>
				</div>
			</div>
		</section>
		<!--================위에 Area 끝=================-->

		<!--================ 폼 Area  =================-->
		<div id="template">
			<article style="border: 1px solid #eeeeee;">
				<div class="container" style="border: 1px solid #eeeeee;">
					<h3>내 가치 설정변경</h3>
				</div>
				<div class="container" style="border: 1px solid #eeeeee;">
					<!--================폼 시작 Area =================-->
					<form role="form" id="frm" name="frm"
						action="/own/band/insertDefault" method="post" autocomplete="off"
						style="width: 80%;" enctype="multipart/form-data">
						<input type="hidden" th:name="${_csrf.parameterName}"
							th:value="${_csrf.token}"> <input type="hidden"
							th:value="${session.userId}" name="userId" id="userId" />
						<div class="imgArea">
							<!--================이미지 Area =================-->
							<div>
								<h4 class="typo-list" style="padding-bottom: 15px">대표 이미지</h4>
							</div>
							<div>
								<div
									style="flex-grow: 3; display: flex; justify-content: space-between;"
									class="imgss">
									<div style="flex-grow: 1; width: 150x; height: 150px;">
										<img th:src="|/imgView/${user.mediaServerFile}|"
											id="inputImage" name="inputImage" alt=""
											style="flex-grow: 1; width: 150x; height: 150px;">
									</div>
									<!--================ 이름 =================-->
									<div
										style="display: inline-block; width: 70%; padding: 10px 0px 0px 50px; flex-grow: 3; display: flex; flex-direction: column;">
										<h6 class="typo-list" style="float: left; padding-left: 10px;">가치
											활동명</h6>
										<div class="mt-10">
											<input type="text" th:value="${user.bandNickname}"
												id="bandNickname" name="bandNickname" maxlength="10"
												placeholder="가치 활동명 입력" onfocus="this.placeholder = ''"
												onblur="this.placeholder = '가치 활동명'" required
												class="single-input"
												style="height: 50px; font-size: 20px; width: 88%; display: block; float: left;">
										</div>
										<b><small
											style="display: inline; width: 10%; float: right"
											id="nickNamelength">4/10</small></b>
										<div id="hiddenBox" style="display: none">
											<b style="padding-left: 10px;" id="hiddenBoxText">가입가능한
												닉네임입니다</b>
										</div>
									</div>
									<!--================ 이름 끝 =================-->
								</div>
							</div>
							<input type="file" id="attachFile" multiple="multiple"
								name="attachFile" style="display: none" onchange="imgFnc()"
								accept="image/gif, image/jpeg, image/png">
							<div class="insertArea"
								style="margin: 0px auto; width: 110%; position: relative; padding: 10px 15px 80px">
								<!--================ 셀렉트박스  =================-->
								<div class="col-md-9"
									style="position: absolute; right: 150px; top: 20px;">
									<div class="boking_table">
										<div class="row">
											<div class="col-md-4">
												<div class="input-group">
													<select class="exercise  form-select"
														th:value="*{exercise}" name="bandInterest">
														<option value="">관심운동..전체</option>
														<option th:each="exe : ${exercise}"
															th:value="${exe.exersubNo}" th:text="${exe.exersubName}"
															th:selected="${#strings.equals(exe.exersubNo, user.bandInterest)}"></option>
													</select>
												</div>
											</div>
											<div class="col-md-5">
												<div class="input-group">
													<select class="location  form-select"
														th:value="*{location}" name="bandLocation">
														<option value="">관심지역..전체</option>
														<option th:each="loc : ${location}"
															th:value="${loc.locCode}" th:text="${loc.locCity}"
															th:selected="${#strings.equals(loc.locCode, user.bandLocation)}"></option>
													</select>
												</div>
											</div>
										</div>
									</div>
								</div>
								<!--================ 셀렉트박스  =================-->
								<button type="button" id="submitBtn"
									class="genric-btn primary circle arrow"
									style="position: absolute; right: 150px; top: 20px; font-size: 20px; margin: 0 auto; display: flex">수정</button>
							</div>
							<!--================이미지 Area 끝 =================-->
						</div>
						<!-- 이미지끝남 -->
					</form>
				</div>
			</article>
			<!--================폼 끝 Area =================-->
			<!--================밴드  Area =================-->
				<div class="wrap container" style="border: 1px solid #eeeeee;">
            <div class="tab_menu">
               <ul class="list">
                  <li>
                     <a id="myBandyIngB" class="btns">가입 가치<b id="BK01num"></b></a>         
                  </li>
                  <li>
                     <a id="myBandyIngRe" class="btns">운영 가치</h3>   <b id="BK02num"></b></a>
                  </li>
                  <li>
                     <a id="myBandyIngYe" class="btns">가입 신청중<b id="BK03num"></b></a>
                  </li>
               </ul>
               <article id="myBandyIng" style="border: 1px solid #eeeeee;  display: none">
                  <div class="container cont">
                        <table>
                           <thead><td></td><td>가치명</td><td>닉네임</td><td>가입일</td><td>탈퇴</td></thead>
                           <tbody>
								<tr th:if="${#strings.equals(b.bandMemberStatus, 'BA02')}"th:each="b : ${band}">
									<td th:if="${b.bandMemberStatus=='BA02'}">
										<div class="bBox">
											<a th:href="|/own/band/bandGroup?bandNo=${b.bandNo}|"style="margin-top:7px;">
												<img th:src="|/imgView/${b.mediaServerFile}|" alt="" class="bProfile">
											</a>
										</div>
									</td>
									<td th:if="${#strings.equals(b.bandMemberStatus, 'BA02')}"><a th:href="|/own/band/bandGroup?bandNo=${b.bandNo}|"style="margin-top:7px;">[[${b.bandName}]]</a></td>
									<td th:if="${#strings.equals(b.bandMemberStatus, 'BA02')}" th:text="${b.bandNickname}"></td>
									<td th:if="${#strings.equals(b.bandMemberStatus, 'BA02')}" th:text="${b.bandSignupDateCha}"></td>
									<td th:if="${#strings.equals(b.bandMemberStatus, 'BA02')}"><button th:unless="${#strings.equals(b.bandLeaderid,b.userId)}" type="button" class="delBtn" th:name="${b.bandNo}">탈퇴</button></td>
								</tr>
                           </tbody>
                        </table>
                     </div>
               </article>
               <article id="myBandyRe" style="border: 1px solid #eeeeee;  display: none">
                  <div class="container cont">
                        <table>
                           <thead><td></td><td>가치명</td><td>닉네임</td><td>가입일</td><td></td></thead>
                           <tbody>
								<tr th:if="${#strings.equals(b.bandLeaderid,b.userId)}" th:each="b : ${band}">
									<td th:if="${b.bandMemberStatus=='BA02'}">
										<div class="bBox">
											<a th:href="|/own/band/bandGroup?bandNo=${b.bandNo}|"style="margin-top:7px;">
												<img th:src="|/imgView/${b.mediaServerFile}|" alt="" class="bProfile">
											</a>
										</div>
									</td>
									<td th:if="${#strings.equals(b.bandMemberStatus, 'BA02')}"><a th:href="|/own/band/bandGroup?bandNo=${b.bandNo}|"style="margin-top:7px;">[[${b.bandName}]]</a></td>
									<td th:if="${#strings.equals(b.bandMemberStatus, 'BA02')}" th:text="${b.bandNickname}"></td>
									<td th:if="${#strings.equals(b.bandMemberStatus, 'BA02')}" th:text="${b.bandSignupDateCha}"></td>
									<td th:if="${#strings.equals(b.bandMemberStatus, 'BA02')}"></td>
								</tr>
                           </tbody>
                        </table>
                     </div>
               </article>
               <article id="myBandyYe" style="border: 1px solid #eeeeee; display: none">
                  <div  class="container cont">
                         <thead><td></td><td>가치명</td><td>닉네임</td><td>가입신청일</td><td>취소</td></thead>
                           <tbody>
								<tr th:if="${#strings.equals(b.bandMemberStatus, 'BA01')}"th:each="b : ${band}">
									<td th:if="${b.bandMemberStatus=='BA01'}">
										<div class="bBox">
											<a th:href="|/own/band/bandGroup?bandNo=${b.bandNo}|"style="margin-top:7px;">
												<img th:src="|/imgView/${b.mediaServerFile}|" alt="" class="bProfile">
											</a>
										</div>
									</td>
									<td th:if="${#strings.equals(b.bandMemberStatus, 'BA01')}"><a th:href="|/own/band/bandGroup?bandNo=${b.bandNo}|"style="margin-top:7px;">[[${b.bandName}]]</a></td>
									<td th:if="${#strings.equals(b.bandMemberStatus, 'BA01')}" th:text="${b.bandNickname}"></td>
									<td th:if="${#strings.equals(b.bandMemberStatus, 'BA01')}" th:text="${b.bandSignupDateCha}"></td>
									<td th:if="${#strings.equals(b.bandMemberStatus, 'BA01')}"><button type="button" class="buttonRe" th:name="${b.bandNo}">철회</button></td>
								</tr>
                           </tbody>
                        </table>
                     </div>
               </article>
            </div>
            </div>
			<!--================밴드 끝 Area =================-->
		</div>

		<!-- Optional JavaScript -->
		<script>
			/*<![CDATA[*/
			var header = '[[${_csrf.headerName}]]';
			var token = '[[${_csrf.token}]]';
			console.log(header);
			console.log(token);
			/*]]>*/
			// 특수문자 정규식 변수(공백 미포함)
			var replaceChar = /[~!@\#$%^&*\()\-=+_'\;<>\/.\`:\"\\,\[\]?|{}]/gi;
			// 완성형 아닌 한글 정규식		
			var replaceNotFullKorean = /[ㄱ-ㅎㅏ-ㅣ]/gi;
			$(function() {
				//별명 중복체크...
				$('#bandNickname').on(
						'change',
						function() {
							let nickName = $('#bandNickname').val();
							if (nickName == '') {
								$('#hiddenBoxText').text('닉네임을 입력해주세요.');
								$('#hiddenBox').show();
							} else if (nickName.match(replaceChar)
									|| nickName.match(replaceNotFullKorean)) {
								$('#hiddenBoxText').text(
										'특수문자를 제외하고 올바른 문자를 입력해주십시오.');
								$('#hiddenBox').show();
							} else {
								$('#hiddenBoxText').text('사용가능한 닉네임입니다.');
								$('#hiddenBox').show();
							}
						})
				//닉네임 공백막기 글자수
				$('#bandNickname').keyup(function(e) {
					//닉네임 공백막기
					if ($(this).val().search(/\s/) != -1) { //공백이 있나 체크 후
						$(this).val($(this).val().replace(/ /gi, ''));
						$('#hiddenBox').show();
						$('#hiddenBoxText').text('공백입력은 불가능합니다.');
					}
					//글자수 체크
					chkNickLength();
				})
				//닉네임 글자수 체크  
				function chkNickLength() {
					$('#nickNamelength').text(
							$('#bandNickname').val().length + '/10');
				}
				//인트로  글자수
				$('#bandMemberIntro').keyup(function(e) {
					//글자수 체크
					chkIntroLength();
				})
				//글자수체크
				chkNickLength();
			})
			//이미지삽임
			$('#inputImage').on('click', function() {
				console.log('???')
				$('#attachFile').click();
			})
			//이미지첨부 눌렀을 때
			function imgFnc() {
				//파일
				let imgFile = $('#attachFile').val();
				//확장자제한
				let fileForm = /(.*?)\.(jpg|jpeg|png)$/;
				//50mb로 제한
				let maxSize = 100 * 1024 * 1024;
				//특수문자 제한
				let pattern = /[\{\}\/?,;:|*~`!^\+<>@\#$%&\\\=\'\"]/gi;
				//파일크기제한
				let fileSize;

				if ($('#attachFile').val() == "") {
					alert("첨부파일은 필수!");
					return;
				}
				//파일명과 사이즈를 뽑기위한..제이쿼리를 모르겠음 이건
				let fileName = document.getElementById("attachFile").files[0]
				//파일이 비었다면
				if (imgFile != "" && imgFile != null) {
					//input=file의 files 속성가져와서...
					fileSize = fileName.size;
					if (!imgFile.match(fileForm)) {
						alert("이미지 파일만 업로드 가능");
						return;
					} else if (fileSize > maxSize) {
						alert("파일 사이즈는 100MB까지 가능");
						return;
					} else if (pattern.test(fileName.name)) {
						alert("파일 이름 특수문자 nono");
						return;
					}
				}
			}
			//이미지 업로드 시 미리보기createImage
			$('#attachFile').on('change', function(e) {
				let file = e.target.files[0];
				let reader = new FileReader();
				reader.onload = function(e) {
					$('#inputImage').attr('src', e.target.result);
					//기존이미지 누를시..
					$('input[name=mediaServerFile]').val('sample')
				}
				reader.readAsDataURL(file);
			})
			//수정
			$('#submitBtn').on('click', function() {
				console.log(JSON.stringify($('#frm').serializeObject()));
				console.log(new FormData(frm));
				console.log(JSON.stringify(new FormData(frm)));
				console.log($('#attachFile'));
				$.ajax({
					url : '/own/band/myBandOption/defalutOptionUpdate',
					type : "put",
					enctype : 'multipart/form-data',
					data : new FormData(frm),
					cache : false,
					contentType : false,
					processData : false,
					dataType : 'json',
					beforeSend : function(xhr) {
						xhr.setRequestHeader(header, token);
					},
					success : function(data) { //data는 url을 가져옴
						if (data > 0) {
							alert('수정완료');
						} else {
							alert('수정실패');
						}
					},
					error : function(e) {
						console.log(e);
					}
				});
			})
			$('#myBandyIngB').on('click', function(){
					console.log('1')
					console.log($('#myBandyIng'))
                  $('#myBandyIng').show();
                  $('#myBandyRe').hide();
                  $('#myBandyYe').hide();
               })
               $('#myBandyIngRe').on('click', function(){
            	   console.log('1')
                  $('#myBandyIng').hide();
                  $('#myBandyRe').show();
                  $('#myBandyYe').hide();
               })
               $('#myBandyIngYe').on('click', function(){
                  $('#myBandyIng').hide();
                  $('#myBandyRe').hide();
                  $('#myBandyYe').show();
               })
           $('button').on('click', function(e){
        	   let bandNo = $(e.target).attr('name');
        	   if(confirm('선택한 가치를 탈퇴합니다.')){
        	   $.ajax({
        	         url: '/own/band/myBandOption/leave?bandNo='+bandNo,
        	            type: "get",
        	         dataType:'json',
        	         method: 'get',
        	         contentType : "application/text; charset=utf-8;",
        	                  success : function(data) { //data는 url을 가져옴
        	                	  console.log(data);
        	                          if(data>0){
        	                        	  alert('탈퇴가 완료되었습니다.')
        	                        	  $(e.target).closest("tr").remove();
        	                          }
        	                        },
        	                        error : function(e) {
        	                            console.log(e);
        	                        }
        	                    });
        	   }
	//취소
		 $('button').on('click', function(e){
        	   let bandNo = $(e.target).attr('name');
        	   if($(e.target).attr('class')=='buttonRe' && confirm('가치 신청을 철회합니다.')){
        	   $.ajax({
        	         url: '/own/band/myBandOption/leave2?bandNo='+bandNo,
        	            type: "get",
        	         dataType:'json',
        	         method: 'get',
        	         contentType : "application/text; charset=utf-8;",
        	                  success : function(data) { //data는 url을 가져옴
        	                	  console.log(data);
        	                          if(data>0){
        	                        	  alert('신청이 철회되었습니다.')
        	                        	  $(e.target).closest("tr").remove();
        	                          }
        	                        },
        	                        error : function(e) {
        	                            console.log(e);
        	                        }
        	                    });
        	   }

           })
           })
		</script>
	</div>
</body>
</html>