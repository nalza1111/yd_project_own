<html xmlns:th="http://www.thymeleaf.org"lang="ko">
<script src="/css/band/js/jquery-3.2.1.js"></script>
<script src="/css/band/js/json.min.js"></script>
<style>
	.modal {
		display: none;
		z-index: 500;
		width: 100%;
		height: 100vh;
		position: fixed;
		top: 0;
		left: 0;
		background-color: rgba(0, 0, 0, 0.3);
	}
	
	.modal button {
		position: absolute;
		top: 3rem;
		right: 3rem;
		background: transparent;
		border: 0;
		color: #ffffff;
		font-size: 3rem;
	}
	
	.modalBox {
		position: relative;
		top: 20%;
		left: 50%;
		transform: translate(-50%, -20%);
		background-color: #ffffff;
		width: 30%;
		height: 30%;
		text-align: center;
	}
	
	.modalBox img {
		width: 100%;
	}
	
	.modalBox p {
		color: #ffffff;
		background-color: #000;
		font-size: 2rem;
		padding: .2rem;
	}
	#my_calendar_modal {
		display: none;
		width: 600px;
		padding: 20px 30px;
		background-color: #fefefe;
		border: 1px solid #888;
		border-radius: 3px;
		position: fixed;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        /* 시꺼먼 레이어 보다 한칸 위에 보이기 */
        z-index: 1000;
        /* div center 정렬 */
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        -ms-transform: translate(-50%, -50%);
        -webkit-transform: translate(-50%, -50%);
	}
	
	#my_calendar_modal .modal_close_btn {
		position: absolute;
		top: 10px;
		right: 10px;
	}
	.bgg {
		position: fixed;
        z-index: 500;
        left: 0px;
        top: 0px;
        width: 100%;
        height: 100%;
        overflow: auto;
        /* 레이어 색갈은 여기서 바꾸면 됨 */
        background-color: rgba(0,0,0,0.4);
	}
	.cModal {
		 position: fixed;
         display: block;
         box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
         /* 시꺼먼 레이어 보다 한칸 위에 보이기 */
         z-index: 1000;
         /* div center 정렬 */
         top: 50%;
         left: 50%;
         transform: translate(-50%, -50%);
         -ms-transform: translate(-50%, -50%);
         -webkit-transform: translate(-50%, -50%);
	}
</style>
<div id="template" style="flex-grow:3; width: 740px">
	<div>
		<article style="border: 1px solid #eeeeee;padding:30px; ">
			<h3>게시판 상세페이지</h3>
			<input type="hidden" id="bandBoardDetailNo" th:value="${board.BandBoardDetailNo}">
			<input type="hidden" id="bandNo" th:value="${board.bandNo}">
			<input type="hidden" id="userId" th:value="${session.loginUser.userId}">
			<div class="form-group">
				Title <input type="text" class="form-control" id="title" th:value="${board.bandBoardTitle }"readonly>
				Writer <input type="text" class="form-control" id="writer" th:value="${board.bandNickName }"readonly>
				RegDate <input type="text" class="form-control" id="RegDate" th:value="${#dates.format(board.bandBoardDate, 'yyyy-MM-dd HH:mm:ss')}"readonly>
				<div class="form-group">
					<label for="comment">Content:</label>
					<div id="bCalendar"></div>
					<div th:utext="${board.bandBoardContent }"></div>
				</div>
				<!--임시-->
				<div  th:each="img : ${board.bandImgs}">
					<img  style="width:678px;" th:src="|/imgView/${img.mediaServerFile}|" alt="">
				</div>
			</div>
		<div>
			<button type="button" id="btnUpdate" class="btn btn-primary mb-2">수정</button>
			<button type="button" id="btnDelete" class="btn btn-primary mb-2">삭제</button>
		</div>
		<div>
			<article id="bandReply">
			</article>
			<article id="bandLike">
			</article>
		</div>	
		<h3>댓글</h3>
		<table class="table" id="replybody">
				<!-- <%-- <tr>
					<td>${reply.replyer}</td>
					<td>${reply.reply}</td>
					<td><c:if test="${reply.replyDate>=reply.updateDate}">${reply.replyDate}</c:if></td>
					<td><c:if test="${reply.replyDate<reply.updateDate}">${reply.updateDate}</c:if></td>
				</tr> --%> -->
		</table> 
		<form id="frmRe">
			<div class="form-group">
				<label for="reply">Content:</label>
				<textarea class="form-control" rows="5" id="reply"></textarea>
				replyer <input type="text" class="form-control" id="replyer">
				<button type="button" id="btnReployInsert" class="btn btn-primary mb-2">댓글작성</button>
			</div>
		</form>
		</article>
	</div>
	<!-- ========이미지 팝업 될 곳======== -->
	<div class="modal">
		<button>&times;</button>
		<div class="modalBox">
			<img src="" alt="">
			<p></p>
		</div>
	</div>
	<!-- ========이미지 팝업 끝======== -->
	<!-- ========일정 모달======== -->
	<!--==캘린더 모달창 ==-->
		<div id="my_calendar_modal">
			<div id="modalform">
                <div>
                	<!--================ 일정명 =================-->
                	<div>
	                  <h6 class="typo-list">일정만들기</h6>
	                  <div>
	                    <input type="text" name="bandCalendarTitle" id="bandCalendarTitle" placeholder="일정 제목을 입력해주세요" onfocus="this.placeholder = ''" onblur="this.placeholder = '일정 제목을 입력해주세요'" required>
	                  </div>
	                </div>
	                <!--================ 일정명 끝 =================-->
	                <!--================ 일정마크 =================-->
                	<div>
	                  <h6 class="typo-list">일정마크</h6>
	                  <div>
	                    <select name='bandCalendarMark' id="bandCalendarMark">
						  <option value='0' selected disabled>-- 선택 --</option>
						  <option value='red' style='padding:15px;'>빨강🔴</option>
						  <option value='orange' style='padding:15px;'>주황🟠</option>
						  <option value='yellow' style='padding:15px;'>노랑🟡</option>
						  <option value='blue' style='padding:15px;'>파랑🔵</option>
						</select>
	                  </div>
	                </div>
	                <!--================ 일정마크 끝 =================-->
	                <!--================ 시작/종료 =================-->
	                <div>
	                  <h6 class="typo-list">시작</h6>
                      <input type="date" name="bandCalendarStartDay" id="bandCalendarStartDay">
                      <input type="time" name="bandCalendarStartTime" id="bandCalendarStartTime">
					  <input type="hidden" name="bandCalendarStart" id="bandCalendarStart">
	                </div>
	                <div>
	                  <h6 class="typo-list">종료</h6>
                      <input type="date" name="bandCalendarEndDay" id="bandCalendarEndDay">
                      <input type="time" name="bandCalendarEndTime" id="bandCalendarEndTime">
					  <input type="hidden" name="bandCalendarEnd" id="bandCalendarEnd">
	                </div>
	                <!--================ 시작/종료 끝 =================-->
	                 <!--================ 위치 =================-->
	                <div>
	                  <h6 class="typo-list">위치</h6>
	                  <div>
	                    <input type="text" id="bandCalendarLocation" name="bandCalendarLocation" value="대구광역시">
	                  </div>
	                </div>
	                <!--================ 위치 끝 =================-->
	                <!--================ 참석여부 =================-->
	                <div>
						<h6 class="typo-list" style="float: left; padding-left: 10px; margin-top: 20px;">참석여부 묻기</h6>
	                	<input type="checkbox" name="bandCalendarOption" value="t" id="bandCalendarOption">
	                    <div id="checkDate" style="display: none">
						<h6 class="typo-list">참석여부 확인 종료일</h6>
	                     	<input type="date" name="bandCalendarOptionDayD" id="bandCalendarOptionDayD">
                      		<input type="time" name="bandCalendarOptionDayT" id="bandCalendarOptionDayT">
							<input type="hidden" name="bandCalendarOptionDay" id="bandCalendarOptionDay">
						</div>
	                </div>
	                <!--================ 참석여부 끝 =================-->
	                <!--================ 공유 =================-->
	                <!-- <div>
						<h6 class="typo-list" style="float: left; padding-left: 10px; margin-top: 20px;">게시글로 공유</h6>
	                	<input type="checkbox" name="bandCalendarOptionShare" value="t" id="bandCalendarOptionShare" checked disabled>
	                </div> -->
	                <!--================ 공유 끝 =================-->
	            </div>
                <button type="button" id="calBtn">전송</button>
			</div>
			<a class="modal_close_btn">닫기</a>
		</div>
<!--==캘린더 모달창 ==-->
	<!-- ========일정 모달 끝======== -->
</div>
<script th:inline="javascript">
$(function(){
	
	
	//일정추가하기....
	/*<![CDATA[*/
	var calendar = /*[[${board.bandCalendar}]]*/
	/*]]>*/
	console.log(calendar);
	if(calendar!=null){
		//타이틀
		let title = calendar.bandCalendarTitle;
		//날짜
		let startDay = calendar.bandCalendarStart;
		let endDay = calendar.bandCalendarEnd;
		let sYear = startDay.substr(0, 4);
		let eYear = endDay.substr(0, 4);
		
		startDay = new Date(calendar.bandCalendarStart);
		endDay = new Date(calendar.bandCalendarEnd);
		
		//달
		let sMonth = (1+startDay.getMonth());
		let eMonth = (1+endDay.getMonth());
		//날
		let sDay = startDay.getDate();
		let eDay = endDay.getDate();
		//시간
		let startTime = startDay.getHours();
		let endTime = endDay.getHours();
		//분
		let startTime2 = startDay.getMinutes()
		let endTime2 = endDay.getMinutes()
		//상세시작시간
		let sTime = (startTime < 12 ? "오전" : "오후")+" "
			sTime += startTime+"시 "
			sTime += startTime2+"분";
		//상세끝나는시간
		let eTime = (endTime < 12 ? "오전" : "오후")+" " //오전 오후
				 + endTime+"시 " //12시간표기
				 + endTime2+"분";
		//시작 요일
		let mon = getDayOfWeek(startDay);
		//마크색
		let color = calendar.bandCalendarMark;
	    let cal  = `<div style="width:678px; height:80px; border: 0.3rem solid ${color}; display:flex; justify-content:space-between" id="calendarModal">`
	    			cal += `<input type="hidden" value="${calendar.bandCalendarNo}">`
	    			cal += `<div style="padding:10px;"><h3 style="margin-bottom:0px">${sDay}</h3>`
					cal += `<p>${mon}</p></div>`
					cal += `<div style="padding:10px;"><h5>${title}</h5>`
					cal += `<p>${sYear}년 ${sMonth}월 ${sDay}일 ${sTime} ~ ${eYear}년 ${eMonth}월 ${eDay}일 ${eTime}</p></div>`
				cal += `</div>`;
		//요일뽑기
		function getDayOfWeek(날짜문자열){ //ex) getDayOfWeek('2022-06-13')
	    	const week = ['일요일', '월요일', '화요일', '수요일', '목요일', '금요일', '토요일'];
	    	const dayOfWeek = week[new Date(날짜문자열).getDay()];
	    	return dayOfWeek;
		}
		$('#bCalendar').append(cal);
	}
	//유저아이디
	let userId = $('#userId').val();
	let bandNo = $('#bandNo').val();
	console.log(userId);
	//좋아요리스트..댓글리스트
	let DetailNo = $('#bandBoardDetailNo').val();
	$.ajax({
		url: '/own/band/bandGroup/bandBoardDetailLike?bandBoardDetailNo='+DetailNo,
		dataType: 'json',
		method: 'get',
		contentType : "application/text; charset=utf-8;"
	}).then(result => {
		console.log(result);
		let likeTag = '';
		$(result).each(function(idx, ele){
        	//likeTAG
        	if(ele.userId==userId){
        		likeTag = '♥'
       			return false;
        	}
		})
		if(likeTag == ''){
			likeTag = '♡'
		}
		//좋아요 수
		let r = result.length;
		if(r == null){
			r = 0;
		}
		$('#bandLike').append(likeTag, r);
	})
	//
// 	이미지 클릭시 해당 이미지 모달
	$("img").click(function(){
		$(".modal").show();
		// 해당 이미지 가겨오기
		var imgSrc = $(this).attr("src");
		var imgAlt = $(this).attr("alt");
		console.log(imgSrc);
		console.log(imgAlt);
		
		$(".modalBox img").attr("src", imgSrc);
		$(".modalBox img").attr("alt", imgAlt);
		
		// 해당 이미지 텍스트 가져오기
		var imgTit =  $(this).children("p").text();
		$(".modalBox p").text(imgTit);
		
   // 해당 이미지에 alt값을 가져와 제목으로
		//$(".modalBox p").text(imgAlt);
	});
	
	//.modal안에 button을 클릭하면 .modal닫기
	$(".modal button").click(function(){
		$(".modal").hide();
	});
	
	//.modal밖에 클릭시 닫힘
	$(".modal").click(function (e) {
    if (e.target.className != "modal") {
      return false;
    } else {
      $(".modal").hide();
    }
	
  });
	//글 수정
	$('#btnUpdate').on('click', function(){
    		$('#template').load("/own/band/bandGroup/bandBoardUpdate?BandBoardDetailNo="+DetailNo+'&bandNo='+bandNo);
	})
	
	//모달
	function calModal(id) {
        var cModal = document.getElementById(id);
		console.log(cModal);	
        // 모달 div 뒤에 희끄무레한 레이어
        var bgg = document.createElement('div');
        console.log(bgg);
        bgg.classList.add('bgg');
        document.body.append(bgg);
		
        cModal.classList.add('cModal');
        cModal.style.display='block';
        document.body.append(cModal);        
        // 닫기 버튼 처리, 시꺼먼 레이어와 모달 div 지우기
        cModal.querySelector('.modal_close_btn').addEventListener('click', function() {
            bgg.remove();
            cModal.style.display = 'none';
        });

    }
	//일정클릭모달
	$('#calendarModal').on('click', function(){
		console.log('1');
		calModal('my_calendar_modal');
	})
})
</script>
