<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/default_layout}">

<head>
	<meta charset="UTF-8">
	<title>Insert title here</title>
	<!-- 폰트어썸 cdn -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" />
	<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
	<style>
		@import url("/css/own/css/reset.css");

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		.formbold-mb-5 {
			margin-bottom: 20px;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.formbold-pt-3 {
			padding-top: 12px;
		}

		.formbold-main-wrapper {
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 48px;
		}

		.formbold-form-wrapper {
			margin: 0 auto;
			max-width: 600px;
			width: 100%;
			background: white;
		}

		.formbold-form-label {
			display: block;
			font-weight: 500;
			font-size: 16px;
			color: #07074d;
			margin-bottom: 12px;
		}

		.formbold-form-label-2 {
			font-weight: 600;
			font-size: 20px;
			margin-bottom: 20px;
		}

		.formbold-form-input {
			width: 100%;
			height: 50px;
			padding: 12px 24px;
			border-radius: 6px;
			border: 1px solid #e0e0e0;
			background: white;
			font-weight: 500;
			font-size: 16px;
			color: #6b7280;
			outline: none;
			resize: none;
		}

		.formbold-form-tArea {
			width: 100%;
			height: 100px;
			padding: 12px 24px;
			border-radius: 6px;
			border: 1px solid #e0e0e0;
			background: white;
			font-weight: 500;
			font-size: 16px;
			color: #6b7280;
			outline: none;
			resize: none;
		}

		.formbold-form-input:focus {
			border-color: #6a64f1;
			box-shadow: 0px 3px 8px rgba(0, 0, 0, 0.05);
		}

		.formbold-form-input__input {
			width: 50px;
		}

		.formbold-btn {
			display: inline-block;
			font-weight: 400;
			color: #666666;
			text-align: center;
			vertical-align: middle;
			user-select: none;
			background-color: transparent;
			border: 1px solid transparent;
			padding: 0.375rem 0.75rem;
			font-size: 1rem;
			line-height: 1.5;
			border-radius: 30px;
			width: 100%;
			transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
		}

		.formbold-btn:hover {
			color: #666666;
			text-decoration: none;

		}

		.formbold-btn-primary {
			color: #fff;
			background-color: #17a2b8;
			border-color: #17a2b8;

		}

		.formbold-btn-primary:hover {
			color: #fff;
			background-color: #138496;
			border-color: #117a8b;
		}

		.formbold--mx-3 {
			margin-left: -12px;
			margin-right: -12px;
		}

		.formbold-px-3 {
			padding-left: 12px;
			padding-right: 12px;
		}

		.flex {
			display: flex;
		}

		.flex-wrap {
			flex-wrap: wrap;
		}

		.w-full {
			width: 100%;
		}

		@media (min-width : 540px) {
			.sm\:w-half {
				width: 50%;
			}
		}

		

		td {
			cursor: pointer;
		}

		/* 컨디션 체크박스 */
		.badImg {
			background-image: url(/css/own/common_img/bad.png);
		}

		.sadImg {
			background-image: url(/css/own/common_img/sad.png);
		}

		.sosoImg {
			background-image: url(/css/own/common_img/soso.png);
		}

		.smileImg {
			background-image: url(/css/own/common_img/smile.png);
		}

		.happyImg {
			background-image: url(/css/own/common_img/happy.png);
		}

		.cc-selector input {
			margin: 0;
			padding: 0;
			-webkit-appearance: none;
			-moz-appearance: none;
			appearance: none;
		}

		.cc-selector input:active+.drinkcard-cc {
			opacity: .5;
		}

		.cc-selector input:checked+.drinkcard-cc {
			-webkit-filter: none;
			-moz-filter: none;
			filter: none;
		}

		.drinkcard-cc {
			cursor: pointer;
			background-size: contain;
			background-repeat: no-repeat;
			display: inline-block;
			width: 100px;
			height: 70px;
			-webkit-transition: all 100ms ease-in;
			-moz-transition: all 100ms ease-in;
			transition: all 100ms ease-in;
			-webkit-filter: brightness(1.8) grayscale(1) opacity(.7);
			-moz-filter: brightness(1.8) grayscale(1) opacity(.7);
			filter: brightness(1.8) grayscale(1) opacity(.7);
		}

		.drinkcard-cc:hover {
			-webkit-filter: brightness(1.2) grayscale(.5) opacity(.9);
			-moz-filter: brightness(1.2) grayscale(.5) opacity(.9);
			filter: brightness(1.2) grayscale(.5) opacity(.9);
		}

		/* 체중 슬라이더 */
		* {
	border: 0;
	box-sizing: border-box;
	margin: 0;
	padding: 0;
}
:root {
	--bg: #e3e4e8;
	--bgT: #e3e4e800;
	--fg: #17181c;
	--inputBg: #fff;
	--handleBg: #255ff4;
	--handleDownBg: #0b46da;
	--handleTrackBg: #5583f6;
	font-size: calc(16px + (32 - 16)*(100vw - 320px)/(2560 - 320));
}
body, input {
	color: var(--fg);
	font: 1em/1.5 "Hind", sans-serif;
}
body, .slidecontainer, .slidecontainer__counter {
	display: flex;
}
body {
	background-color: var(--bg);
}

label {
	font-weight: bold;
}
.slidecontainer:not(:last-child) {
	margin-bottom: 1.5em;
}
.slidecontainer input[type=range],
.slidecontainer input[type=range]::-webkit-slider-thumb {
	-webkit-appearance: none; 
	appearance: none;
}
.slidecontainer input[type=range], .slidecontainer__input-fill {
	border-radius: 0.25em;
	height: 0.5em;
}
.slidecontainer input[type=range] {
	background-color: var(--inputBg);
	display: block;
	margin: 0.5em 0;
	padding: 0;
}
.slidecontainer input[type=range]:focus {
	outline: transparent;
}
.slidecontainer input[type=range]::-webkit-slider-thumb {
	background-color: var(--handleBg);
	border: 0;
	border-radius: 50%;
	cursor: pointer;
	position: relative;
	transition: background 0.1s linear;
	width: 1.5em;
	height: 1.5em;
	z-index: 1;
}

.slidecontainer__input, .slidecontainer__input-fill, .slidecontainer__counter-column, .slidecontainer__counter-digit {
	display: block;
}
.slidecontainer__input, .slidecontainer__counter {
	position: relative;
}
.slidecontainer__input {
	margin-right: 0.375em;
}
.slidecontainer__input:active input[type=range]::-webkit-slider-thumb,
.slidecontainer input[type=range]:focus::-webkit-slider-thumb,
.slidecontainer input[type=range]::-webkit-slider-thumb:hover {
	background-color: var(--handleDownBg);
}

.slidecontainer__input-fill, .slidecontainer__counter-sr {
	position: absolute;
	left: 0;
}
.slidecontainer__input-fill {
	background-color: var(--handleTrackBg);
	pointer-events: none;
	top: calc(50% - 0.25em);
}
.slidecontainer__counter, .slidecontainer__counter-digit {
	height: 1.5em;
}
.slidecontainer__counter {
	margin: auto 0;
	overflow: hidden;
	text-align: center;
}
.slidecontainer__counter-sr {
	background-image: linear-gradient(var(--bg),var(--bgT) 0.3em 1.2em,var(--bg));
	color: transparent;
	letter-spacing: 0.06em;
	top: 0;
	text-align: right;
	z-index: 1;
}
.slidecontainer__counter-column {
	transition: transform 0.25s ease-in-out;
	width: 0.66em;
	-webkit-user-select: none;
	-moz-user-select: none;
	user-select: none;
}
.slidecontainer__counter-column--pause {
	transition: none;
}
@media (prefers-color-scheme: dark) {
	:root {
		--bg: #2e3138;
		--bgT: #2e313800;
		--fg: #e3e4e8;
		--inputBg: #17181c;
	}
}
	</style>
</head>
<div layout:fragment="content">

	<body>
		<div class="formbold-main-wrapper">
			<div class="formbold-form-wrapper">
				<div class="formbold-mb-5" id="current_date">
					<h1><strong></strong>년 <strong></strong>월 <strong></strong>일</h1>
				</div>
				<div class="formbold-mb-5">
					<p>
					<h1 th:text="${session.loginUser.userName}"></h1>&nbsp&nbsp<h2>회원님의 운동 기록하기</h2>
					</p>
				</div>

				<form id="exerciseRecordForm" name="exerciseRecordForm" action="/own/ownRecordList">
					<div class="formbold-mb-5" id="moodcontainer">
						<div class="cc-selector">
							<input id="badImg" type="radio" name="exerecCondition" value="1" />
							<label class="drinkcard-cc badImg" for="badImg"></label>
							<input id="sadImg" type="radio" name="exerecCondition" value="2" />
							<label class="drinkcard-cc sadImg" for="sadImg"></label>
							<input id="sosoImg" type="radio" name="exerecCondition" value="3" />
							<label class="drinkcard-cc sosoImg" for="sosoImg"></label>
							<input id="smileImg" type="radio" name="exerecCondition" value="4" />
							<label class="drinkcard-cc smileImg" for="smileImg"></label>
							<input id="happyImg" type="radio" name="exerecCondition" value="5" />
							<label class="drinkcard-cc happyImg" for="happyImg"></label>
						</div>
					</div>
					<div class="formbold-mb-5">
						<div class="slidecontainer">
							<label for="exerecWeight">체중</label>
							<input type="range" min="30" max="120" value="1" class="Weightslider" name="exerecWeight"
								id="myWeight">
						</div>
					</div>
					<div class="formbold-mb-5">
						<i class="fas fa-search"></i> <input type="text" id="exerInput" onkeyup="myFunction()"
							placeholder="운동명 검색" class="formbold-form-input">
						<div class="exerciseSearch" style="width: 100%; height: 200px; overflow: auto">
							<table id="exerTable">
							</table>
						</div>
					</div>

					<div class="formbold-mb-5">
						<div id="recordDiv" style="display: none;">
							<input name="exersubNo" hidden> <label for="exerecTime" class="formbold-form-label"> Time
							</label> <input type="number" name="hour" id="hour" placeholder="hour"
								class="formbold-form-input" /> : <input type="number" name="minute" id="minute"
								placeholder="minute" class="formbold-form-input" /> <input name="exerecTime" hidden>
							<div id="meterDiv" style="display: none;">
								<label for="exerecMeter" class="formbold-form-label">distance
								</label> <input type="number" name="meter" id="meter" class="formbold-form-input">Km
								<input name="exerecMeter" hidden>
							</div>
							<label for="exerecRoution" class="formbold-form-label">Routin
							</label>
							<textarea name="exerecRoution" id="routin" class="formbold-form-tArea"></textarea>
							<label for="exerecFeedback" class="formbold-form-label">Feedback</label>
							<textarea name="exerecFeedback" id="feedback" class="formbold-form-tArea"></textarea>
						</div>
					</div>

					<div class="flex flex-wrap formbold--mx-3">
						<div class="w-full sm:w-half formbold-px-3">
							<div class="formbold-mb-5 w-full">
								<label for="date" class="formbold-form-label"> Date </label> <input type="date"
									name="date" id="date" class="formbold-form-input" />
							</div>
						</div>
						<div class="w-full sm:w-half formbold-px-3">
							<div class="formbold-mb-5">
								<label for="time" class="formbold-form-label"> Time </label> <input type="time"
									name="time" id="time" class="formbold-form-input" />
							</div>
						</div>
					</div>

					<div class="formbold-mb-5 formbold-pt-3">
						<label class="formbold-form-label formbold-form-label-2">
							Address Details </label>
						<div class="flex flex-wrap formbold--mx-3">
							<div class="w-full sm:w-half formbold-px-3">
								<div class="formbold-mb-5">
									<input type="text" name="area" id="area" placeholder="Enter area"
										class="formbold-form-input" />
								</div>
							</div>
							<div class="w-full sm:w-half formbold-px-3">
								<div class="formbold-mb-5">
									<input type="text" name="city" id="city" placeholder="Enter city"
										class="formbold-form-input" />
								</div>
							</div>
							<div class="w-full sm:w-half formbold-px-3">
								<div class="formbold-mb-5">
									<input type="text" name="state" id="state" placeholder="Enter state"
										class="formbold-form-input" />
								</div>
							</div>
							<div class="w-full sm:w-half formbold-px-3">
								<div class="formbold-mb-5">
									<input type="text" name="post-code" id="post-code" placeholder="Post Code"
										class="formbold-form-input" />
								</div>
							</div>
						</div>
					</div>

					<div>
						<button class="formbold-btn formbold-btn-primary" type="button" id="insertBtn">기록하기</button>
					</div>
				</form>
			</div>
		</div>
	</body>
	<script th:inline="javascript">
		/*<![CDATA[*/
		var header = /*[[${_csrf.headerName}]]*/'defalut';
		var token = /*[[${_csrf.token}]]*/'defalut';
		console.log(header);
		console.log(token);
		/*]]>*/

		// 오늘 날짜 띄우기
		date = new Date();
		year = date.getFullYear();
		month = date.getMonth() + 1;
		day = date.getDate();
		$('#current_date').find('strong').eq(0).text(year);
		$('#current_date').find('strong').eq(1).text(month);
		$('#current_date').find('strong').eq(2).text(day);


		// 체중 슬라이더 설정
		var slider = document.getElementById("myRange");
		var output = document.getElementById("value");
		output.innerHTML = slider.value;

		slider.oninput = function () {
			output.innerHTML = this.value;
		}

		// 컨디션 라디오 박스 
		function checkedFnc(img) {
			img.previousElementSibling.checked = true;
			// if (document.querySelector('[name="exerecCondition"]:checked')) {
			// 	img.style.outline = '5px solid indigo';
			// } else {
			// 	img.style.outline = '0px';
			// }

		}

		//운동 이름 가져오기
		$.ajax({
			url: '/common/exersub',
			method: 'get',
			//dataType : 'object' ,//응답결과랑 타입이 같아야함
			contentType: "application/json" //json으로 보낼때 타입이 이렇다..
		}).then(res => {
			for (sub of res) {
				$("#exerTable").append(makeTr(sub));
			}
		})


		function makeTr(sub) {

			let tr = `<tr><td data-sub="${sub.exersubNo}" onClick="showForm(this)">${sub.exersubName}</td></tr>`

			return tr;
		}

		// 운동 검색
		function myFunction() {
			var input, filter, table, tr, td, i, txtValue;
			input = document.getElementById("exerInput");
			filter = input.value.toUpperCase();
			table = document.getElementById("exerTable");
			tr = table.getElementsByTagName("tr");
			for (i = 0; i < tr.length; i++) {
				td = tr[i].getElementsByTagName("td")[0];
				if (td) {
					txtValue = td.textContent || td.innerText;
					if (txtValue.toUpperCase().indexOf(filter) > -1) {
						tr[i].style.display = "";
					} else {
						tr[i].style.display = "none";
					}
				}
			}
		}

		// 운동 클릭시 폼 생성
		function showForm(td) {
			let name = td.getAttribute("data-sub");
			if (name == "EXS_1" || name == "EXS_5" || name == "EXS_11" || name == "EXS_12" || name == "EXS_14" || name == "EXS_18" || name == "EXS_29") {
				document.getElementById("recordDiv").style.display = "block";
				document.getElementById("meterDiv").style.display = "block";
				$('[name="exersubNo"]').attr('value', name);
			} else {
				document.getElementById("recordDiv").style.display = "block"
				document.getElementById("meterDiv").style.display = "none";
				$('[name="exersubNo"]').attr('value', name);
			}
		}

		// 기록 등록
		$('#insertBtn').on("click", function () {
			let time = $('[name="exerecTime"]').attr('value', Number($('#hour').val()) * 60 + Number($('#minute').val()));
			let meter = $('[name="exerecMeter"]').attr('value', Number($('#meter').val()) * 1000);
			$.ajax({
				url: '/own/exerciseRecord',
				method: 'post',
				contentType: 'application/x-www-form-urlencoded',
				data: $('form[name="exerciseRecordForm"]').serialize(),
				beforeSend: function (xhr) {
					xhr.setRequestHeader(header, token);
				},
				success: function (result) {
					console.log("result: " + result);
					$('#exerciseRecordForm').submit();
				},
				error: function (error) {
					console.log("error: " + error);
				}
			})
		})
	</script>
</div>

</html>