<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/default_layout}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style>
#my_modal {
	display: none;
	width: 500px;
	height: 400px;
	padding: 20px 60px;
	background-color: #fefefe;
	border: 1px solid #888;
	border-radius: 3px;
}

#my_modal .modal_close_btn {
	position: absolute;
	top: 10px;
	right: 10px;
}
</style>
</head>

<div layout:fragment="content">
	<body>
		<h1>질문관리</h1>
		<table>
			<thead>
				<th>질문번호</th>
				<th>질문자ID</th>
				<th>제목</th>
				<th>내용</th>
				<th>답변</th>
				<th>질문날짜</th>
				<th>머리말
				<th>
				<th>상태</th>
			</thead>
			<tbody></tbody>
			<tr th:each="quest : ${QList}">
				<td th:text="${quest.questNo}"></td>
				<td th:text="${quest.userId}"></td>
                <span th:if="${quest.answer==null}">
				<td class="titlemodal" th:text="${quest.title}"
					th:id="${quest.questNo}"></td>
                </span>
                <span th:unless="${quest.answer==null}">
                    <td th:text="${quest.title}"
                        th:id="${quest.questNo}"></td>
                </span>

				<td th:text="${quest.content}"></td>
				<span th:if="${quest.answer==null}">
					<td>미처리 상태</td>
				</span>
				<span th:unless="${quest.answer==null}">
					<td th:text="${quest.answer}"></td>
				</span>
				<td th:text="${quest.questDate}"></td>
				<td th:text="${quest.header}"></td>
				<td th:text="${quest.status}"></td>
		</table>

		<!--모달창-->
		<div id="my_modal">
			<form action="/questionUpdate" method="post" id="modalform">
                <input type="hidden" th:name="${_csrf.parameterName}"
					th:value="${_csrf.token}">    
				<div class="form-group">
					<label for="recipient-name" class="col-form-label">질문제목</label>
                    <span id="modaltitle"></span>
				</div>
				<div class="form-group">
					<label for="message-text" class="col-form-label">질문내용</label> <span
						id="modalcontent"></span>
				</div>
				<div class="form-group">
					<label for="message-text" class="col-form-label">답변</label>
					<textarea class="form-control" id="message-text" name="answer"></textarea>
				</div>
                <button type="submit">전송</button>
			</form>
			<a class="modal_close_btn">닫기</a>
		</div>
	</body>
	<script>
	function modal(id) {
        var zIndex = 9999;
        var modal = document.getElementById(id);

        // 모달 div 뒤에 희끄무레한 레이어
        var bg = document.createElement('div');
        bg.setStyle({
            position: 'fixed',
            zIndex: zIndex,
            left: '0px',
            top: '0px',
            width: '100%',
            height: '100%',
            overflow: 'auto',
            // 레이어 색갈은 여기서 바꾸면 됨
            backgroundColor: 'rgba(0,0,0,0.4)'
        });
        document.body.append(bg);

        // 닫기 버튼 처리, 시꺼먼 레이어와 모달 div 지우기
        modal.querySelector('.modal_close_btn').addEventListener('click', function() {
            bg.remove();
            modal.style.display = 'none';
        });

        modal.setStyle({
            position: 'fixed',
            display: 'block',
            boxShadow: '0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19)',

            // 시꺼먼 레이어 보다 한칸 위에 보이기
            zIndex: zIndex + 1,

            // div center 정렬
            top: '50%',
            left: '50%',
            transform: 'translate(-50%, -50%)',
            msTransform: 'translate(-50%, -50%)',
            webkitTransform: 'translate(-50%, -50%)'
        });
    }
	 Element.prototype.setStyle = function(styles) {
         for (var k in styles) this.style[k] = styles[k];
         return this;
     };

			$('.titlemodal').on('click',function(){
			modal('my_modal');
			let qno = $(this).attr('id')
			console.log($(this).attr('id'));
			$.ajax({
				url : '/own/admin/selectquest',
				method : 'get',
				data : {qno}
			}).then(res=>{
                $('#modalform').append(`<input type="hidden" value="${res.questNo}" name="questNo">`)
                $('#modaltitle').html(res.title);
				console.log(res);
			})		
		})
	</script>
</div>
</html>