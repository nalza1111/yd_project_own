<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>

    <!-- ========== Meta Tags ========== -->
    <meta charset="UTF-8">
    <meta name="description" content="Cocoon -Portfolio">
    <meta name="keywords" content="Cocoon , Portfolio">
    <meta name="author" content="Pharaohlab">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <!-- ========== Title ========== -->
    <title> Cocoon -Portfolio</title>
    <!-- ========== Favicon Ico ========== -->
    <!--<link rel="icon" href="fav.ico">-->
    <!-- ========== STYLESHEETS ========== -->
    <!-- Bootstrap CSS -->
    <link href="/css/sns/css/bootstrap.min.css" rel="stylesheet">
    <!-- Fonts Icon CSS -->
    <link href="/css/sns/css/font-awesome.min.css" rel="stylesheet">
    <link href="/css/sns/css/et-line.css" rel="stylesheet">
    <link href="/css/sns/css/ionicons.min.css" rel="stylesheet">
    <!-- Carousel CSS -->
    <link href="/css/sns/css/slick.css" rel="stylesheet">
    <!-- Magnific-popup -->
    <link rel="stylesheet" href="/css/sns/css/magnific-popup.css">
    <!-- Animate CSS -->
    <link rel="stylesheet" href="/css/sns/css/animate.min.css">
    <!-- Custom styles for this template -->
    <link href="/css/sns/css/main.css" rel="stylesheet">

    <style>
        /* The Modal (background) */
        .searchModal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            z-index: 10;
            /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            /* Full width */
            height: 100%;
            /* Full height */
            overflow: auto;
            /* Enable scroll if needed */
            background-color: rgb(0, 0, 0);
            /* Fallback color */
            background-color: rgba(0, 0, 0, 0.4);
            /* Black w/ opacity */
        }

        /* Modal Content/Box */
        .search-modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 70%;
            /* Could be more or less, depending on screen size */
        }

        #snsprofilebox {
            border: 1px solid black;
            text-align: center;
            padding: 20px;
        }

        .homeProfile {
            margin-bottom: 40px;
        }
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }
        /* Modal Content/Box */
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto; /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 50%; /* Could be more or less, depending on screen size */
        }
        /* The Close Button */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        .storyProfileImg {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            position: absolute;
            top: -5px;
            left: -10px;
        }

        .storyProfileName {
            font-size: 15px;
            position: absolute;
            top: 6px;
            left: 57px;
            font-weight: 600;
        }
        .storyImg {
            width: 600px;
            height: 518px;
            position: absolute;
            top: 0px;
            left: -20px;
            object-fit: cover;
        }

        .storyProfileDate {
            position: absolute;
            top: 6px;
            right: 5px;
            font-size: 14px;
        }
        .action-btns {
            position: absolute;
            z-index: 30;
        }

        .Feedbtn {
            width: 4rem;
            height: 4rem;
            background-color:rgba(128, 128, 128,.3);
            transition: all .3s;
            border: none;
            cursor: pointer;
            font-size: 1.6rem;
            color:#fff;
        }
        li.dot{
            background-color: lightgray; 
        }
        li.dot:hover {
            background-color: lightblue;
        }
        li.dot.active {
            background-color: skyblue;
        }
        .blog_card_top{
            opacity: 0;
        }
        .blog_card_top.active{
            transform: translateX(0);
            opacity: 1;
            visibility: visible;
            z-index: 20;
        }

    </style>

    
    <!-- bootstrap -->
    <script src="/css/sns/js/jquery.min.js"></script>
    <script src="/css/sns/js/popper.js"></script>
    <script src="/css/sns/js/bootstrap.min.js"></script>
    <script src="/css/sns/js/waypoints.min.js"></script>
    <!--slick carousel -->
    <script src="/css/sns/js/slick.min.js"></script>
    <!--Portfolio Filter-->
    <script src="/css/sns/js/imgloaded.js"></script>
    <script src="/css/sns/js/isotope.js"></script>
    <!-- Magnific-popup -->
    <script src="/css/sns/js/jquery.magnific-popup.min.js"></script>
    <!--Counter-->
    <script src="/css/sns/js/jquery.counterup.min.js"></script>
    <!-- WOW JS -->
    <script src="/css/sns/js/wow.min.js"></script>
    <!-- Custom js -->
    <script src="/css/sns/js/main.js"></script>
    <script>
            $(document).ready(function(){
                $(".blog_card .blog_card_top:first-child").addClass("active");
                $(".blog_card .dot:first-child").addClass("active");

            });
        </script>
</head>

<body>
    <div layout:fragment="content">
        <div class="loader">
            <div class="loader-outter"></div>
            <div class="loader-inner"></div>
        </div>

        <div class="body-container container-fluid">
            <a class="menu-btn" href="javascript:void(0)">
                <i class="ion ion-grid"></i>
            </a>
            <div class="row justify-content-center">
                <!--=================== side menu ====================-->
                <div class="col-lg-2 col-md-3 col-12 menu_block">

                    <!--logo -->
                    <div class="logo_box">
                        <a href="#"><img src="/css/sns/img/logo.png" alt="cocoon"></a>
                    </div>
                    <!--logo end-->

                    <!--main menu -->
                    <div class="side_menu_section">
                        <ul class="menu_nav">
                            <li><a href="/own/home">Home</a></li>
                            <li><a th:href="@{snsFeed(snsNickname=${snsInfo.snsNickname})}">나의 피드</a></li>
                            <li><a href="services.html">Services</a></li>
                            <li class="active"><a href="/own/sns">sns메인</a></li>
                            <li><a href="contact.html">Contact</a></li>
                        </ul>
                    </div>
                    <!--main menu end -->

                    <!--filter menu -->
                    <div class="side_menu_section">
                        <h4 class="side_title">filter by:</h4>
                        <ul id="filtr-container" class="filter_nav">
                            <li data-filter="*" class="active"><a href="javascript:void(0)">all</a></li>
                            <li data-filter=".branding"> <a href="javascript:void(0)">branding</a></li>
                            <li data-filter=".design"><a href="javascript:void(0)">design</a></li>
                            <li data-filter=".photography"><a href="javascript:void(0)">photography</a></li>
                            <li data-filter=".architecture"><a href="javascript:void(0)">architecture</a></li>
                        </ul>
                    </div>
                    <!--filter menu end -->


                    <!--social and copyright -->
                    <div class="side_menu_bottom">
                        <div class="side_menu_bottom_inner">
                            <ul class="social_menu">
                                <li>
                                    <a href="#"> <i class="ion ion-social-pinterest"></i> </a>
                                </li>
                                <li>
                                    <a href="#"> <i class="ion ion-social-facebook"></i> </a>
                                </li>
                                <li>
                                    <a href="#"> <i class="ion ion-social-twitter"></i> </a>
                                </li>
                                <li>
                                    <a href="#"> <i class="ion ion-social-dribbble"></i> </a>
                                </li>
                            </ul>
                            <div class="copy_right">
                                <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                                <p class="copyright">Copyright &copy;<script>
                                        document.write(new Date().getFullYear());
                                    </script> All rights reserved | This template is made with <i class="fa fa-heart-o"
                                        aria-hidden="true"></i> by <a href="https://colorlib.com"
                                        target="_blank">Colorlib</a></p>
                                <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                            </div>
                        </div>
                    </div>
                    <!--social and copyright end -->

                </div>
                <!--=================== side menu end====================-->

                <!--=================== content body 메인====================-->
                <div class="col-lg-10 col-md-9 col-12 body_block  align-content-center">
                    <br>
                    <div id="snsprofilebox" class="modalBtn">
                        <span class="storyInfo" th:each="story : ${storyInfo}">
                            <span th:if="${story.mediaServerFile != null}">
                                <img th:src="|/imgView/${story.mediaServerFile}" 
                                    style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover;">
                            </span>
                            <span th:unless="${story.mediaServerFile != null}">
                                <img src="/css/sns/img/defaultUser.png" 
                                    style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover;">
                            </span>
                            <span class="storyNickname" th:text="${story.snsNickname}" 
                            	  style="font-size:16px; padding-right:30px; cursor: pointer;"></span>
                        </span>
                    </div>


                    <!-- 첫 번째 Modal -->
                    <div class="modal">
                        <div class="modal-content" style="width: 500px; height: 600px;">
                            <span class="close"></span>
                            <div class="storyProfile" style="position:relative; width: 450px; height: 60px;">
                            </div>
                            <div class="storyContent" style="position:relative; width:498px;">

                            </div>
                        </div>
                    </div>
                    <hr>
                    <hr>
                    <!-- sns 메인 -->
                    <div class="blog">
                        <div class="row justify-content-center">
                            <div class="col-lg-8 col-md-12 col-12" style="padding-left: 70px;">
                                <th:block th:each="now, stat : ${nowFeed}">
                                    <article class="blog_card" th:if="${snsFollow != 0}">
                                        <div class="homeProfile">
                                            <img th:src="|/imgView/${now.mediaServerFile}"
                                                style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover;">
                                            <a th:href="@{/own/snsFeed(snsNickname=${now.snsNickname})}">
                                                <span th:text="${now.snsNickname}"
                                                    style="font-size: 20px; padding-left: 10px;"></span></a>
                                        </div>
                                        <div class="feedImg" style="position: relative; width: 800px; height: 500px;">
                                            <div class="blog_card_top" th:each="nowimg : ${now.fileList}"
                                                th:data-item="${nowimg.mediaNo}">
                                                <img th:src="|/imgView/${nowimg.mediaServerFile}"
                                                    style="position: absolute; width: 800px; height: 500px; object-fit: cover;" />
                                            </div>
                                        </div>
                                        <div class="container-dots" style="display:flex; justify-content: center; width:900px; height: 100px; margin: 0 auto; padding-inline-start: 0px;">
                                            <ul class="dots-parent" style="list-style:none;" >
                                                <li class="dot" th:each="nowimg2 : ${now.fileList}" th:data-item="${nowimg2.mediaNo}"
                                                    style="float:left; width: 20px; height: 20px; border-radius: 50%; border: 1px solid black; margin-right: 10px; cursor:pointer;"></li>
                                            </ul>
                                        </div>
                                        <div class="blog_card_bottom">

                                            <div class="meta_data">
                                                <span>좋아요 수</span>
                                                <span>댓글 수 </span>
                                                <span> [[${now.snsBoardDate}]] </span>
                                            </div>
                                            <p>게시글내용 /
                                                <p th:text="${now.snsBoardContent}"></p>
                                            </p>
                                        </div>
                                    </article>
                                </th:block>


                                <article class="blog_card" th:if="${snsFollow == 0}">
                                    <div class="blog_card_top">
                                        <img style="margin: 100px; margin-left: 250px;" src="/css/sns/img/tung.png"
                                            alt="blog title " />
                                    </div>
                                </article>
                            </div>

                        </div>
                    </div>
                </div>
                <!--=================== content body end ====================-->
            </div>
        </div>

        <!--  ========== SNS 계정 간편가입 모달 ==========  -->
 <div th:if="${session.loginUser.snsAccountNo == null}">
            <div id="modal" class="searchModal">
                <div class="search-modal-content">
                    <div class="page-header">
                        <h1>MODAL</h1>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="row">
                                <div class="col-sm-12">
                                    <h2>SNS 간편가입이 필요한 페이지입니다. 회원 가입을 하시겠습니까?</h2>
                                    <form action="/own/snsAccount" method="post">
                                        <label>ID정보</label>
                                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                                        <div th:text="${session.loginUser.userId}"></div>
                                        <input name="userId" type="hidden" th:value="${session.loginUser.userId}">
                                        <br>
                                        <label>Email정보</label>
                                        <div th:text="${session.loginUser.userEmail}"></div>
                                        <label>SNS 닉네임</label>
                                        <input type="text" name="snsNickname" placeholder="SNS에서 사용할 닉네임 입력">
                                        <input type="submit" role="button" value="SNS 가입" />
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div style="cursor:pointer;background-color:#DDDDDD;text-align: center;padding-bottom: 10px;padding-top: 10px;"
                        onClick="closeModal();">닫기
                        <span class="pop_bt modalCloseBtn" style="font-size: 13pt;">
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <!-- ========== 모달 end ===========  -->

        <script th:inline="javascript">
        /*<![CDATA[*/
        var header = /*[[${_csrf.headerName}]]*/ 'defalut';
        var token = /*[[${_csrf.token}]]*/ 'defalut';
        /*]]>*/
            // jQuery(document).ready(function () {
            //     $("#modal").show();
            // });

            function closeModal() {
                $('.searchModal').hide();
                alert("메인페이지로 이동합니다.")
                location.href = "/own/home"
            };
        
        // $('.dots-parent').on("click", '.dot', function(e){
        //     console.log('단추 클릭')
        //     var dataItem = $(e.target)
        //     console.log(dataItem)

        // })

        //게시글 이미지 페이징
        $('.dot').each(function(){
            $(this).on("click", function(e){
                $('.dot').not(this).removeClass("active");
                $(this).addClass("active");
                console.log(this);
                console.log('단추클릭');
                console.log($(this).attr("data-item"));
                let btnData = $(this).attr("data-item");
                $(e.target).find('.blog_card_top').not('[data-item="'+btnData+'"]').removeClass("active")
                $('.blog_card_top[data-item="'+btnData+'"]').addClass("active")

            })
        })
        //스토리 상세보기 ajax
        $('.modalBtn').on("click",'.storyInfo', function (e) {
           
            // console.log($(this).text());
             var storyNickname = $(e.target).text()
             $(".modal").show();
                $.ajax({
                url: '/own/snsStoryList',
                method: 'post',
                data: {
                    snsNickname: storyNickname
                },
                beforeSend: function (xhr) {
                    xhr.setRequestHeader(header, token);
                },
                success: function (res) {
                    console.log("1-----------------------")
                    console.log(res)

                    console.log("2-----------------------")
                    console.log(res.storyImg)

                    console.log("3-----------------------")
                    console.log(res.profileImg)

                    console.log("4-----------------------")
                    console.log(res.storyInfo)

                   
                    let storyProfileImg = "";
                    if(res.profileImg != null){
                        storyProfileImg = $('<img>').attr({
                            "src": "/imgView/" + res.profileImg.mediaServerFile,
                            "class": "storyProfileImg"
                        })
                    }else{    
                        
                        storyProfileImg = $('<img>').attr({
                            "src": "/css/sns/img/defaultUser.png",
                            "class": "storyProfileImg" 
                        })
                    }
                        let storyProfileName = $('<span>').text(res.storyInfo[0].snsNickname)
                        storyProfileName.attr('class', "storyProfileName")


                    $('.storyProfile').append(storyProfileImg);
                    $('.storyProfile').append(storyProfileName);

                    for (let i = res.storyImg.length - 1; i >= 0; i--) {
                        let storyImg = $('<img>').attr({
                            "src": "/imgView/" + res.storyImg[i].mediaServerFile,
                            "class": "storyImg"
                        })
                        let storyProfileDate = $('<span>').text(elapsedText(res.storyInfo[i]
                            .snsStoryDate))
                        storyProfileDate.attr('class', "storyProfileDate");
                        $('.storyProfile').append(storyProfileDate);
                        $('.storyContent').append(storyImg);
                    }


                },
                error: function (err) {
                    console.log(err)
                }
            })
        })


            //시간계산 함수
            function elapsedText(date) {
                console.log(date);
                date = new Date(date);
                // 초 (밀리초)
                const seconds = 1;
                // 분
                const minute = seconds * 60;
                // 시
                const hour = minute * 60;
                // 일
                const day = hour * 24;

                var today = new Date();
                var elapsedTime = Math.trunc((today.getTime() - date.getTime()) / 1000);

                var elapsedText = "";
                if (elapsedTime < seconds) {
                    elapsedText = "방금 전";
                } else if (elapsedTime < minute) {
                    elapsedText = elapsedTime + "초 전";
                } else if (elapsedTime < hour) {
                    elapsedText = Math.trunc(elapsedTime / minute) + "분 전";
                } else if (elapsedTime < day) {
                    elapsedText = Math.trunc(elapsedTime / hour) + "시간 전";
                } else if (elapsedTime < (day * 3)) {
                    elapsedText = Math.trunc(elapsedTime / day) + "일 전";
                } else {
                    elapsedText = SimpleDateTimeFormat(date, "yyyy-MM-dd");
                }

                return elapsedText;
            }

            // Modal 영역 밖을 클릭하면 Modal을 닫습니다.
            window.onclick = function (event) {
                if (event.target.className == "modal") {
                    event.target.style.display = "none";
                    $('.storyProfile').children().remove();
                    $('.storyContent').children().remove();
                }
            };

            
 
        </script>



    </div>
</body>

</html>